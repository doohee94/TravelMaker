<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admin">
	<select id="cnt" parameterType="hashMap" resultType="java.lang.Integer">
		SELECT count(*) as cnt
		FROM ${table}
		<where>
			<if test="sel != null">
				${sel} like '%'||#{con}||'%'
			</if>
		</where>
	</select>
	
	<select id="cntparlist"  resultType="java.lang.Integer">
		SELECT count(*) as cnt
		FROM partner
		WHERE partner_state = 20
		<if test="partnerComname != null">
			AND partner_comname like '%'||#{partnerComname}||'%'
		</if>
	</select>
	
	<select id="cntparrec"  resultType="java.lang.Integer">
		SELECT count(*) as cnt
		FROM partner
		WHERE partner_state = 10
		<if test="partnerComname != null">
			AND partner_comname like '%'||#{partnerComname}||'%'
		</if>
	</select>
	
	<select id="memberlist" parameterType="hashMap" resultType="adminMemberDTO">
		SELECT *
		FROM (SELECT rownum as rnum, g.*  
      		  FROM (SELECT * 
            		FROM member
            		<where>
            			<if test="sel != null">
							${sel} like '%'||#{con}||'%'
						</if>
            		</where>
            		order by user_id desc) g)
		<where>
			<if test="id != null">
				user_id = #{id}
			</if>
			<if test="startnum != null">
				rnum <![CDATA[>=]]>  #{startnum} AND rnum <![CDATA[<=]]> #{endnum}
			</if>
		</where>
	</select>
	
	<select id="qnalist" parameterType="hashMap" resultType="tm.admin.dto.AdminQnaDTO">
		SELECT *
		FROM (SELECT rownum as rnum, g.*  
      		  FROM (SELECT * 
            		FROM qna  
            		order by rownum desc) g)
		WHERE rnum <![CDATA[>=]]>  #{startnum} AND rnum <![CDATA[<=]]> #{endnum}
	</select>
	
	<update id="reply" parameterType="tm.admin.dto.AdminQnaDTO">
		UPDATE QNA 
		SET qna_reply = #{qnaReply}
		WHERE qna_num = #{qnaNum}
	</update>
	
	<select id="adlist" resultType="tm.admin.dto.AdminadDTO">
		SELECT *
		FROM advertisement
	</select>
	
	<select id="allist" parameterType="hashMap" resultType="allianceDTO">
		SELECT *
		FROM (SELECT rownum as rnum, g.*  
      		  FROM (SELECT * 
            		FROM partner
            		WHERE partner_state = 20   
            		order by partner_num desc) g)
		<where>
			<if test="startnum != null">
				rnum <![CDATA[>=]]>  #{startnum} AND rnum <![CDATA[<=]]> #{endnum}
			</if>
			<if test="partnerComname != null">
				AND partner_comname like '%'||#{partnerComname}||'%'
			</if>
		</where>
	</select>
	
	<select id="allistRec" parameterType="hashMap" resultType="allianceDTO">
		SELECT *
		FROM (SELECT rownum as rnum, g.*  
      		  FROM (SELECT * 
            		FROM partner
            		WHERE partner_state = 10 
            		order by partner_num desc) g)
		<where>
			<if test="startnum != null">
				rnum <![CDATA[>=]]>  #{startnum} AND rnum <![CDATA[<=]]> #{endnum}
			</if>
			<if test="partnerComname != null">
				AND partner_comname like '%'||#{partnerComname}||'%'
			</if>
		</where>
	</select>
	
	<select id="adnumber" resultType="String">
		SELECT seq_advertisement.nextval as num
		FROM dual 
	</select>
	
	
	<insert id="adinsert" parameterType="tm.admin.dto.AdminadDTO">
		INSERT INTO advertisement
		(ad_num,   
		partner_num,
		ad_title,
		ad_photo,
		ad_photofake,
		ad_check,
		ad_stdate,
		ad_eddate)
		VALUES (
		#{adNum},
		#{partnerNum},
		#{adTitle},
		#{adPhoto},
		#{adPhotofake},
		0,
		#{adStdate},
		#{adEddate}
		)
	</insert>
	
	<delete id="addelete" parameterType="hashMap">
		DELETE FROM advertisement
		WHERE ad_num=#{adnum}
	</delete>
	
	<delete id="alliancedel" parameterType="hashMap">
		DELETE FROM partner
		WHERE partner_num=#{partnernum}
	</delete>
	
	<update id="allianceapproval" parameterType="hashMap">
		UPDATE partner
		SET partner_state = 20,
		partner_type = 10
		WHERE partner_num=#{partnernum}
	</update>
	
	<update id="typeupdate" parameterType="allianceDTO">
		UPDATE partner
		SET partner_type = #{partnerType}
		WHERE partner_num=#{partnerNum}
	</update>
	
	<select id="stemplist" resultType="tm.admin.dto.AdminStempDTO">
		SELECT *
		FROM (SELECT rownum as rnum, g.*  
      		  FROM (SELECT s.parstemp_num, 
      		  				p.partner_num, 
      		  				s.partner_name, 
      		  				s.partner_addr, 
      		  				p.partner_ceoname,
      		  				p.partner_reginum, 
      		  				p.partner_comname, 
      		  				p.partner_tel
                  FROM parstemp s, partner p
                  WHERE s.partner_num = p.partner_num 
                  ORDER BY s.parstemp_num desc) g)
	</select>
	
	<select id="cntad" parameterType="hashMap" resultType="java.lang.Integer">
		SELECT count(*) as cnt
		FROM advertisement
		WHERE partner_num = #{partnernum}
	</select>
	
</mapper>